# ####################################################################
# # This file is managed by Puppet. Any changes will be overwritten. #
# ####################################################################
[Unit]
Description=Start a stunnel listener
Wants=network-online.target

[Service]
Type=simple
<% if @_chroot -%>
ExecStartPre=-/usr/bin/pkill -f "stunnel /etc/stunnel/stunnel.conf" -F <%= @_chroot %><%= @_legacy_pid %> ; rm <%= @_chroot %><%= @_legacy_pid %>
<% else -%>
ExecStartPre=-/usr/bin/pkill -f "stunnel /etc/stunnel/stunnel.conf" -F <%= @_legacy_pid %> ; rm <%= @_chroot %><%= @_legacy_pid %>
<% end -%>
ExecStart=/usr/bin/stunnel /etc/stunnel/stunnel.conf
KillMode=process
LimitNOFILE=1048576
LimitNPROC=infinity
Restart=on-failure

[Install]
WantedBy=multi-user.target
